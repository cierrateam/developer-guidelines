<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="When we create a new website with nuxt, that are our steps to deploy it with forge.">

        <meta property="og:site_name" content="cierra Developer Guideline"/>
        <meta property="og:title" content="Setup Nuxt.js with Forge | cierra Developer Guideline"/>
        <meta property="og:description" content="When we create a new website with nuxt, that are our steps to deploy it with forge."/>
        <meta property="og:url" content="https://jigsaw-docs-template.tighten.co/docs/deployments/nuxt-forge"/>
        <meta property="og:image" content="/assets/img/cierra-dark.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="cierra Developer Guideline">
        <meta name="twitter:card" content="summary_large_image">

        
        <title>cierra Developer Guideline | Setup Nuxt.js with Forge</title>

        <link rel="home" href="https://jigsaw-docs-template.tighten.co">
        <link rel="icon" type="image/png" href="/favicon.png"/>

        
                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="/assets/build/css/main.css?id=ef52d393b9b726ce2a09">

            </head>

    <body class="flex flex-col justify-between min-h-screen bg-gray-100 text-gray-800 leading-normal font-sans">
        <header class="flex items-center shadow bg-white border-b h-24 mb-8 py-4" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="cierra Developer Guideline home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="/assets/img/cierra-dark.png" alt="cierra Developer Guideline logo" />

                        <h1 class="text-lg md:text-2xl text-blue-900 font-semibold hover:text-blue-600 my-0 pr-4">cierra Developer Guideline</h1>
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10">
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-blue-500 border border-blue-500 h-10 mr-4 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </header>

        <main role="main" class="w-full flex-auto">
            <section class="container max-w-8xl mx-auto px-6 md:px-8 py-4">
    <div class="flex flex-col lg:flex-row">
        <nav id="js-nav-menu" class="nav-menu hidden lg:block">
            <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/getting-started"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Getting Started
        </a>
    
            
        <ul class="my-0">
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/project-setups/index"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Project Setups
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/project-setups/statamic"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Statamic
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/deployments/index"
            class="lvl0 lvl0-active  nav-menu__item hover:text-blue-500"
        >
            Deployment Setups
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/deployments/nuxt-forge"
            class="lvl1  active font-semibold text-blue-500 nav-menu__item hover:text-blue-500"
        >
            Nuxt Forge
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/env-setups/index"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Environment Setups
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/env-setups/windows-homestead"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Windows (Homestead)
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/env-setups/windows-docker"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Windows (Docker)
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/env-setups/mac-valet"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            MacOS (Valet)
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/env-setups/mac-docker"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            MacOS (Docker)
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/github/index"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Github Setups
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/github/repository"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Repositories
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="/docs/error-handling/index"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Error handling / Debugging
        </a>
    
            
        <ul class="my-0">
            <li class="pl-4">
            
        <a href="/docs/error-handling/bugsnag"
            class="lvl1   nav-menu__item hover:text-blue-500"
        >
            Bugsnag
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <a href="https://jigsaw.tighten.co/docs/installation"
            class="lvl0   nav-menu__item hover:text-blue-500"
        >
            Docs for the Docs
        </a>
    
    </li>
    </ul>
        </nav>

        <div class="DocSearch-content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
            <h2>1- Pre-requisits</h2>

<p>Before starting to describe the process of deploying a Nuxt app with Laravel Forge, I will assume that you have already:</p>

<ul>
<li>Deployed a server with Forge using hetzner. This server must be running Node v8 or later (see below for upgrade)</li>
<li>Your github account is linked with Forge</li>
<li>Created a Nuxt app and linked it to a github repository under a master branch. We will call this repository <code>nuxt-forge-client</code></li>
<li>Setup a domain that we will call <code>nuxt-forge.com</code>. Please make sure to replace any reference to this domain by your own domain. Please make sure your domain is pointing to your server IP provisioned with Forge.</li>
</ul>

<p>To update your Node version with Forge:
* connect to your server via terminal with ssh
* edit the <code>/etc/apt/sources.list.d/nodesource.list</code> file by just replacing the right version number. From me, I just replaced 6 to 8
* <code>sudo apt-get update &amp;&amp; sudo apt-get upgrade</code> for the changes to take effect. You will find your sudo password with the email you received from Forge when provisioning your server.</p>

<h2>2- Setup a new site in Forge</h2>

<ul>
<li>Domain: <code>nuxt-forge.com</code></li>
<li>Aliases: <code></code>(Leave it  blank)</li>
<li>Project type: <code>Static HTML</code></li>
<li>Web Directory: <code>/</code></li>
<li>Leave the <code>Allow Wildcard Sub-Domains</code> checkbox unchecked</li>
</ul>

<p><strong>Note:</strong> The Project type in Forge is not linked to the project type with Nuxt. Using this setting will still enable you to use SPA and Universal apps with Nuxt.js .</p>

<h2>3- Github repository</h2>

<p>Under your server, select the site you have just created and under Apps in the menu, link your Github repository to your new site:
* Provider: <code>Github</code>
* Repository: <code>sbkl/nuxt-forge-client</code> (sbkl is my Github username. nuxt-forge-client the Github repository)
* Branch: <code>master</code>
* Uncheck the <code>Install Composer dependencies</code> as we are not using PHP for this app
* Click <code>Install Repository</code></p>

<h2>4- SSL</h2>

<p>Once your new site is available, select SSL in the menu and add your SSL certificates. I'm using Let's Encrypt. You need to wait for Forge to install the certificates and activate them before to go further.</p>

<h2>5- Apps: Deployment</h2>

<p>Select Apps in the menu and click on <code>Enable Quick Deploy</code> under the Deployment section.</p>

<p>Quick deploy is a functionality that Forge is providing. Each time you push new commits to your project under the master branch, Forge will automatically deploy the changes to production using the script under the Deploy Script section below.</p>

<h2>6- Apps: Deploy Script</h2>

<p>In the Deploy Script section, replace the initial script with the script below:</p>

<pre><code>cd /home/forge/nuxt-forge.com

git checkout .

git pull origin master

npm install --production

npm run build

pm2 start npm --name "nuxt-forge.com" --watch -- start
</code></pre>

<p>Once done, click on <code>Save Script</code>.</p>

<h2>7- Nginx configuration file</h2>

<p>Go at the bottom of the page where you should find a button <code>Files</code>. Click on this button and select <code>Edit Nginx configuration</code>.</p>

<p>The Nginx config below is largely inspired by the existing one under the <a href="https://nuxtjs.org/faq/nginx-proxy">Using nginx as a proxy</a> section of the Nuxt.js faq but got some differences. It also assumes that you already have created your SSL certificates as described above.</p>

<pre><code># FORGE CONFIG (DO NOT REMOVE!)
include forge-conf/nuxt-forge.com/before/*;

map $sent_http_content_type $expires {
    "text/html"                 epoch;
    "text/html; charset=utf-8"  epoch;
    default                     off;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name .nuxt-forge.com;
    root /home/forge/nuxt-forge.com/;

    # FORGE SSL (DO NOT REMOVE!)
    ssl_certificate /etc/nginx/ssl/nuxt-forge.com/123456/server.crt;
    ssl_certificate_key /etc/nginx/ssl/nuxt-forge.com/123456/server.key;

    ssl_protocols TLSv1.2;
    ssl_ciphers ECDHE-*********************************************************************;
    ssl_prefer_server_ciphers on;
    ssl_dhparam /etc/nginx/dhparams.pem;

    add_header X-Frame-Options "SAMEORIGIN";
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    charset utf-8;

    # FORGE CONFIG (DO NOT REMOVE!)
    include forge-conf/nuxt-forge.com/server/*;

    location / {
        expires $expires;

        proxy_redirect off;
        proxy_set_header Host               $host;
        proxy_set_header X-Real-IP          $remote_addr;
        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto  $scheme;
        proxy_read_timeout          1m;
        proxy_connect_timeout       1m;
        proxy_pass                          http://127.0.0.1:3000; # set the address of the Node.js
    }

    access_log off;
    error_log  /var/log/nginx/nuxt-forge.com-error.log error;

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
# FORGE CONFIG (DO NOT REMOVE!)
include forge-conf/nuxt-forge.com/after/*;
</code></pre>

<p>Once done, click the <code>Save</code> button.</p>

<p>Once complete, you should see the following message:</p>

<p>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful</p>

<p>Click <code>OK</code>.</p>

<h2>8- Time to deploy</h2>

<p>The configuration is now ready to deploy your app for the first time.</p>

<p>Select Apps in the menu and click the <code>Deploy</code> button under the Deployment section and wait for it to finish. Once done, you can visit your domain and should be able to see your app live!</p>

<h2>9- Last step</h2>

<p>Before to make changes to your master branch and enjoy the quick deploy functionality, you need to modify the script section as follow:</p>

<ul>
<li>Replace:</li>
</ul>

<p><code>pm2 start npm --name "nuxt-forge.com" --watch -- start</code></p>

<ul>
<li>With:</li>
</ul>

<p><code>pm2 restart nuxt-forge.com</code></p>

<p>This way, each time you push new changes to your master branch, the deployment process will also restart your node.js server instance with pm2 to take into account the changes.</p>

<p>Don't forget to click on <code>Save Script</code>.</p>
        </div>
    </div>
</section>
        </main>

        <script src="/assets/build/js/main.js?id=07c06e86399bc87f6c3c"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>

        <footer class="bg-white text-center text-sm mt-12 py-4" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center">
                <li class="md:mr-2">
                    &copy; <a href="https://tighten.co" title="Tighten website">Cierra GmbH</a> 2022.
                </li>

                <li>
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>
    </body>
</html>
